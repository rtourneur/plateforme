---
# tasks file for mysql

- name: create mysql data directory
  file:
    path: "{{mysql_data_home_dir}}/{{env}}/{{name}}"
    state: directory
  tags: [mysqlComponent]

- name: copy mysql database creation file
  command: cp {{project_home_dir}}/{{database.path}}/{{item}} {{mysql_data_home_dir}}/{{env}}/{{name}}/ creates="{{mysql_data_home_dir}}/{{env}}/{{name}}/{{item}}"
  with_items: "{{database.scripts}}"
  tags: [mysqlComponent]
  notify:
  - create mysql database

- name: start mysql container
  docker:
    name: "{{name}}_{{env}}"
    image: "{{image}}"
    state: started
    ports:
    - "{{ports.mysql.host}}:{{ports.mysql.container}}"
    env:
      MYSQL_ROOT_PASSWORD: "{{database.password}}"
    volumes:
    - "{{mysql_data_home_dir}}/{{env}}/{{name}}:/var/lib/mysql"
    docker_api_version: 1.18
  tags: [mysqlComponent]
  notify:
  - wait mysql initialisation
